node {
    checkout scm
    // docker.image('maven:3.5.4-alpine').inside('-v /root/.m2:/root/.m2') {
    //     stage('Build') {
    //         sh 'mvn -B -DskipTests clean package'
    //     }
    //     stage('Test') {
    //         sh 'mvn test'
    //     }
    //     stage('Deliver') {
    //         sh './jenkins/scripts/deliver.sh'
    //     }
    // }
    docker.image('ubuntu:latest').inside('--user=root') {
        stage('Deploy') {
            sh "apt update -y && apt install openssh-client -y"
            sh "eval $(ssh-agent -s)"
            withCredentials([
                    sshUserPrivateKey(credentialsId: 'root', keyFileVariable: 'key')
                ]) {
                    sh "echo '$key' | tr -d '\r' | ssh-add -"
                    sh "mkdir -p ~/.ssh"
                    sh "chmod 700 ~/.ssh"
                    sh "ssh -o StrictHostKeyChecking=no ubuntu@tkjpedia.com 'ls -al'"
                }
        } 
    }
}